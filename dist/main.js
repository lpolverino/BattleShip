(()=>{"use strict";const e=(e,t)=>{const r=document.createElement("td");return r.dataset.column=e,r.dataset.row=t,r.classList.add(e+"-"+t),r.innerText="#"===e?t:"-",r},t=(t,r,a)=>{const n=document.createElement("tr");for(let o=0;o<a;o++){const a=e(r[o],t);n.appendChild(a)}return n},r=(e,r,n)=>{const o=(e,t,a)=>{((e,t,r,a)=>{const n=t+"-"+(r+1);let o;o="player"===e?document.getElementsByClassName(n)[1]:document.getElementsByClassName(n)[0],o.innerText=((e,t,r)=>"player"===t?r.ship?r.shot?"R":"S":"W":r.ship&&r.shot?"R":"W")(0,e,a)})(r,e,t,a)},i=document.createElement("div");i.classList.add("gameboard");const c=(()=>{const e=document.createElement("table"),r=["#","a","b","c","d","e","f","g","h","i","j"],a=(e=>{const t=document.createElement("tr");return e.forEach((e=>{const r=document.createElement("td");r.innerText=e,t.appendChild(r)})),t})(r);e.appendChild(a);for(let a=1;a<=10;a++){const n=t(a,r,11);e.appendChild(n)}return e})();return setTimeout((()=>a(r,o,n)),0),i.appendChild(c),i},a=(e,t,r)=>{r("player"===e,t)},n=()=>{const e=[],t=(t,r)=>!!e.some((e=>e.column===t&&e.row===r));return{attack:(r,a)=>{if(t(r,a))throw new Error("Already shooted in that position");e.push({column:r,row:a})},hasAttacked:t}},o=()=>{let e=(()=>{let e={};return["a","b","c","d","e","f","g","h","i","j"].forEach((t=>{e[t]=new Array(10).fill({ocupied:!1,receivedAttack:!1})})),e})(),t=!1;const r=(t,r)=>e[t][r].ocupied,a=e=>({ocupied:!0,ship:e}),n=(e,t,r,a)=>{((e,t,r)=>{o(t,r+e-1)})(e,t,r);const n=(e=>{if(e<1||e>4)throw new Error("Invalid length provided");const t=e;let r=0;return{length:()=>t,isSunked:()=>t===r,hit:()=>{r++}}})(e);((e,t)=>{let r=0;for(;r<e;)t(r),r++})(e,(e=>a(e,n)))},o=(t,r)=>{if(!e.hasOwnProperty(t)||r>9)throw new Error("invalid cordinate")};return{hasShip:r,deployHorizontalShip:(t,r,o)=>{n(t,r,o,((t,n)=>{e[r][o+t]=a(n)}))},deployVerticalShip:(t,r,o)=>{const i=["a","b","c","d","e","f","g","h","i","j"];let c=i.indexOf(r);n(t,r,c,((t,r)=>{e[i[c+t]][o]=a(r)}))},receiveAttack:(r,a)=>{o(r,a),e[r][a].ocupied&&(e[r][a].ship.hit(),e[r][a].ship.isSunked()&&(()=>{let t=!0;const r=e=>!e.ocupied||e.ship.isSunked();for(const a in e)t=t&&e[a].every(r);return t})()&&(t=!0)),e[r][a].receivedAttack=!0},hasBeenAtacked:(t,r)=>(o(t,r),e[t][r].receivedAttack),wippedBoard:()=>t,iterateMap:t=>{for(const a in e)e[a].forEach(((e,n)=>{t(a,n,{shot:e.receivedAttack,ship:!!e.receiveAttack&&r(a,n)})}))},iterateShipMap:t=>{for(const r in e)e[r].forEach(((e,a)=>{t(r,a,{ship:e.ocupied,shot:e.receivedAttack})}))}}},i=(e,t)=>{t.forEach((t=>{"Horizontal"===t.direction||1===t.direction?e.deployHorizontalShip(t.size,t.column,t.row):e.deployVerticalShip(t.size,t.column,t.row)}))},c=()=>({column:"a",row:1});!async function(){const e=()=>!!t.hasWinner()&&(a.renderGameOver(t.winner()),!0);let t=function(e,t){let r=(()=>{let e=0;return{currentTurn:()=>e+1,pass:()=>{e=(e+1)%2}}})(),a={gameboard:o(),player:n()},d={gameboard:o(),player:n()};i(a.gameboard,[]),i(d.gameboard,[]);const s=()=>a.gameboard.wippedBoard()||d.gameboard.wippedBoard(),l=()=>1===r.currentTurn();return{hasWinner:s,isPlayerTurn:l,playTurn:(e,t)=>{if(s())throw new Error("Cant play turn if the game  is over");l()?(a.player.attack(e,t),d.gameboard.receiveAttack(e,t)):(d.player.attack(e,t),a.gameboard.receiveAttack(e,t)),r.pass()},winner:()=>s()?a.gameboard.wippedBoard()?1:0:-1,gameboards:()=>({player:a.gameboard,computer:d.gameboard}),getComputerPlay:c,iterateMap:(e,t)=>e?a.gameboard.iterateShipMap(t):d.gameboard.iterateMap(t)}}(),a=function(){let e=document.getElementById("player"),t=document.getElementById("enemy");return{intialize:(a,n,o)=>{const i=((e,t,a)=>r(0,"enemy",e))(a,n.player),c=((e,t)=>r(0,"player",e))(a,n.computer);e.appendChild(i),t.appendChild(c)},render:()=>{},renderGameOver:()=>{}}}();a.intialize(t.iterateMap,t.gameboards(),((r,n)=>{try{t.playTurn(r,n)}catch(e){}if(!e()){a.render(t.gameboards());const r=t.getComputerPlay();t.playTurn(r.column,r.row),e()||a.render(t.gameboards())}}))}()})();