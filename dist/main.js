(()=>{"use strict";const e=(e,t)=>{const r=document.createElement("td");return r.dataset.column=e,r.dataset.row=t,r.classList.add(e+"-"+t),r.innerText="#"===e?t:"-",r},t=(t,r,n)=>{const a=document.createElement("tr");for(let o=0;o<n;o++){const n=e(r[o],t);a.appendChild(n)}return a},r=(e,t,r,n)=>{const a=t+"-"+(r+1);let o;o="player"===e?document.getElementsByClassName(a)[1]:document.getElementsByClassName(a)[0],o.classList.add(((e,t)=>"player"===e?t.ship?t.shot?"hit":"ship":"water":t.ship&&t.shot?"hit":"water")(e,n))},n=(e,n)=>{const o=(t,n,a)=>{r(e,t,n,a)},i=document.createElement("div");i.classList.add("gameboard");const d=(()=>{const e=document.createElement("table"),r=["#","a","b","c","d","e","f","g","h","i","j"],n=(e=>{const t=document.createElement("tr");return e.forEach((e=>{const r=document.createElement("td");r.innerText=e,t.appendChild(r)})),t})(r);e.appendChild(n);for(let n=1;n<=10;n++){const a=t(n,r,11);e.appendChild(a)}return e})();return setTimeout((()=>a(e,o,n)),0),i.appendChild(d),i},a=(e,t,r)=>{r("player"===e,t)},o=(e,t,r=!1)=>{t(r,e)},i={createComputerGameboard:(e,t)=>{const r=n("enemy",e),a=(e,r,n)=>{const a=e+"-"+(r+1);document.getElementsByClassName(a)[0].addEventListener("click",(n=>{n.preventDefault(),t(e,r)}))};return setTimeout((()=>{o(a,e)})),r},createPlayeGameboard:(e,t)=>{const r=n("player",e),a=(e,r,n)=>{const a=e+"-"+(r+1);let o=document.getElementsByClassName(a)[1];o.ondragover=function(e){e.preventDefault()},o.addEventListener("drop",(e=>{e.preventDefault(),t(e)}))};return setTimeout((()=>{o(a,e,!0)})),r},createMessage:e=>{const t=document.createElement("div");t.classList.add("message");const r=document.createElement("p");return r.innerText=e,t.appendChild(r),t},createButton:(e,t,r)=>{const n=document.createElement("div");n.id=t;const a=document.createElement("button");return a.innerText=r,a.onclick=e,n.appendChild(a),n.classList.add("btn"),n},fillBoard:a,fillCell:r,createShips:(e,t,r)=>{const n=document.createElement("div");return n.id="ships",r.forEach((r=>{const a=((e,t,r)=>{const n=document.createElement("div");return n.dataset.position=e.position,n.dataset.size=e.size,n.innerText=e.name+" "+e.size,n.id=e.name,n.draggable=!0,n.onclick=r,n.ondragstart=t,n})(r,e,t);n.appendChild(a)})),n},createMessegeBoard:()=>{const e=document.createElement("div");return e.id="msg-board",e},createButtonConteiner:()=>{const e=document.createElement("div");return e.id="btn-con",e}};function d(e){let t,r,n=document.getElementById("player"),a=document.getElementById("enemy"),o=document.getElementById("drag-section");document.getElementById("content");const d=e=>{for(;e.firstChild;)e.removeChild(e.lastChild)},c=e=>{document.getElementById("msg-board").innerText=e};return{intialize:(c,s,l,m,p)=>{t=s,r=c,d(n),d(a),d(o),document.querySelectorAll(".message").forEach((e=>{e.remove()})),document.querySelectorAll(".btn").forEach((e=>{e.remove()}));const u=i.createComputerGameboard(r,t),h=i.createPlayeGameboard(r,m),g=i.createMessegeBoard(),y=i.createShips(l,p,e),f=i.createButtonConteiner();n.appendChild(u),a.appendChild(h),o.appendChild(g),o.appendChild(y),o.appendChild(f)},renderEnemy:()=>{i.fillBoard("enemy",((e,t,r)=>{i.fillCell("enemy",e,t,r)}),r)},renderPlayer:()=>{i.fillBoard("player",((e,t,r)=>{i.fillCell("player",e,t,r)}),r)},renderGameOver:(e,t)=>{c("Game Over: "+e+" Wins!");const r=i.createButton(t,"btn-reply","Reply");document.getElementById("btn-con").appendChild(r)},renderStart:e=>{const t=i.createButton(e,"btn-start","Go!");document.getElementById("btn-con").appendChild(t)},renderMessage:c}}const c=()=>{const e=[],t=(t,r)=>!!e.some((e=>e.column===t&&e.row===r));return{attack:(r,n)=>{if(t(r,n))throw new Error("Already shooted in that position");e.push({column:r,row:n})},hasAttacked:t}},s=()=>{let e=(()=>{let e={};return["a","b","c","d","e","f","g","h","i","j"].forEach((t=>{e[t]=new Array(10).fill({ocupied:!1,receivedAttack:!1})})),e})(),t=!1;const r=(t,r)=>e[t][r].ocupied,n=e=>({ocupied:!0,ship:e}),a=(t,r,n,a)=>{let o=0,i=!0;if("horizontal"===r)for(;o<t;)i=i&&!e[n][a+o].ocupied,o++;else{const r=["a","b","c","d","e","f","g","h","i","j"];for(;o<t;)i=i&&!e[r[n+o]][a].ocupied,o++}if(!i)throw new Error("Bad request")},o=(e,t,r,n)=>{((e,t,r)=>{i(t,r+e-1)})(e,t,r);const a=(e=>{if(e<1||e>4)throw new Error("Invalid length provided");const t=e;let r=0;return{length:()=>t,isSunked:()=>t===r,hit:()=>{r++}}})(e);((e,t)=>{let r=0;for(;r<e;)t(r),r++})(e,(e=>n(e,a)))},i=(t,r)=>{if(!e.hasOwnProperty(t)||r>9)throw new Error("invalid cordinate")};return{hasShip:r,deployHorizontalShip:(t,r,i)=>{a(t,"horizontal",r,i),o(t,r,i,((t,a)=>{e[r][i+t]=n(a)}))},deployVerticalShip:(t,r,i)=>{const d=["a","b","c","d","e","f","g","h","i","j"];let c=d.indexOf(r);a(t,"vertical",c,i),o(t,r,c,((t,r)=>{e[d[c+t]][i]=n(r)}))},receiveAttack:(r,n)=>{i(r,n),e[r][n].ocupied&&(e[r][n].ship.hit(),e[r][n].ship.isSunked()&&(()=>{let t=!0;const r=e=>!e.ocupied||e.ship.isSunked();for(const n in e)t=t&&e[n].every(r);return t})()&&(t=!0)),e[r][n].receivedAttack=!0},hasBeenAtacked:(t,r)=>(i(t,r),e[t][r].receivedAttack),wippedBoard:()=>t,iterateMap:t=>{for(const n in e)e[n].forEach(((e,a)=>{t(n,a,{shot:e.receivedAttack,ship:!!e.receivedAttack&&r(n,a)})}))},iterateShipMap:t=>{for(const r in e)e[r].forEach(((e,n)=>{t(r,n,{ship:e.ocupied,shot:e.receivedAttack})}))}}},l=(e,t)=>{t.forEach((t=>{"Horizontal"===t.direction||1===t.direction?e.deployHorizontalShip(t.size,t.column,t.row):e.deployVerticalShip(t.size,t.column,t.row)}))};function m(e,t){let r=(()=>{let e=0;return{currentTurn:()=>e+1,pass:()=>{e=(e+1)%2}}})(),n={gameboard:s(),player:c()},a={gameboard:s(),player:c(),shots:0};l(n.gameboard,e),l(a.gameboard,t);const o=()=>n.gameboard.wippedBoard()||a.gameboard.wippedBoard(),i=()=>1===r.currentTurn();return{hasWinner:o,isPlayerTurn:i,playTurn:(e,t)=>{if(o())throw new Error("Cant play turn if the game  is over");i()?(n.player.attack(e,t),a.gameboard.receiveAttack(e,t)):(a.player.attack(e,t),n.gameboard.receiveAttack(e,t)),r.pass()},winner:()=>o()?n.gameboard.wippedBoard()?1:0:-1,gameboards:()=>({player:n.gameboard,computer:a.gameboard}),getComputerPlay:()=>(a.shots++,{column:"a",row:a.shots}),iterateMap:(e,t)=>e?n.gameboard.iterateShipMap(t):a.gameboard.iterateMap(t),addShip:(e,t,r,a)=>{l(n.gameboard,[{direction:"H"===e?1:2,size:t,column:r,row:a}])}}}const p=[{name:"Destroyer",size:4,position:"H"},{name:"AirShip",size:3,position:"H"},{name:"Submarine",size:3,position:"H"},{name:"Ship",size:2,position:"H"},{name:"Boat",size:1,position:"H"}];!async function(){let e,t=d(p),r=!1,n=0;function a(e){e.dataTransfer.setData("position",e.target.dataset.position),e.dataTransfer.setData("size",e.target.dataset.size)}function o(e){e.preventDefault();var r={direction:e.dataTransfer.getData("position"),size:Number(e.dataTransfer.getData("size")),column:e.target.dataset.column,row:Number(e.target.dataset.row)};return n++,5===n&&t.renderStart((e=>{l(),e.target.disabled=!0})),r}function i(e){e.preventDefault(),e.target.dataset.position="H"===e.target.dataset.position?"V":"H"}const c=()=>{e=m([],[{direction:1,size:2,column:"a",row:1}]),t.intialize(e.iterateMap,h,a,o,i),t.renderMessage("Drag and Drop the ships below to the bottom gamboard.\n Click the boat to change its direction")},s=()=>!!e.hasWinner()&&(u(),t.renderGameOver(0===e.winner()?"Player":"Computer",c),!0),l=()=>{r=!0},u=()=>{r=!1},h=(n,a)=>{if(r){try{e.playTurn(n,a),t.renderMessage("player attack column: "+n+" row: "+a)}catch(e){console.log(e),t.renderEnemy("Error ocurred check the console")}if(!s()){t.renderEnemy();const r=e.getComputerPlay();setTimeout((()=>{e.playTurn(r.column,r.row),t.renderMessage("IA attack column: "+r.column+" row: "+r.row),s()||t.renderPlayer()}),1e3)}}};e=m([],[{direction:1,size:2,column:"a",row:1}]),t.intialize(e.iterateMap,h,a,(n=>{if(!r){const{direction:r,size:a,column:i,row:d}=o(n);try{e.addShip(r,a,i,d-1),t.renderPlayer()}catch(e){console.log("Error bad request")}}}),i),t.renderMessage("Drag and Drop the ships below to the bottom gamboard.\n Click the boat to change its direction")}()})();