(()=>{"use strict";const e=(e,t)=>{const r=document.createElement("td");return r.dataset.column=e,r.dataset.row=t,r.classList.add(e+"-"+t),r.innerText="#"===e?t:"-",r},t=(t,r,n)=>{const a=document.createElement("tr");for(let o=0;o<n;o++){const n=e(r[o],t);a.appendChild(n)}return a},r=(e,t,r,n)=>{const a=t+"-"+(r+1);let o;o="player"===e?document.getElementsByClassName(a)[1]:document.getElementsByClassName(a)[0],o.innerText=((e,t)=>"player"===e?t.ship?t.shot?"R":"S":"W":t.ship&&t.shot?"R":"W")(e,n)},n=(e,n)=>{const o=(t,n,a)=>{r(e,t,n,a)},i=document.createElement("div");i.classList.add("gameboard");const c=(()=>{const e=document.createElement("table"),r=["#","a","b","c","d","e","f","g","h","i","j"],n=(e=>{const t=document.createElement("tr");return e.forEach((e=>{const r=document.createElement("td");r.innerText=e,t.appendChild(r)})),t})(r);e.appendChild(n);for(let n=1;n<=10;n++){const a=t(n,r,11);e.appendChild(a)}return e})();return setTimeout((()=>a(e,o,n)),0),i.appendChild(c),i},a=(e,t,r)=>{r("player"===e,t)},o={createComputerGameboard:(e,t)=>{const r=n("enemy",e),a=(e,r,n)=>{const a=e+"-"+(r+1);document.getElementsByClassName(a)[0].addEventListener("click",(n=>{n.preventDefault(),t(e,r)}))};return setTimeout((()=>{((e,t)=>{t(!1,e)})(a,e)})),r},createPlayeGameboard:e=>n("player",e),createMessage:e=>{const t=document.createElement("div");t.classList.add("message");const r=document.createElement("p");return r.innerText=e,t.appendChild(r),t},createButton:(e,t)=>{const r=document.createElement("div");r.id=t;const n=document.createElement("button");return n.innerText=t,n.onclick=e,r.appendChild(n),r.classList.add("btn"),r},fillBoard:a,fillCell:r,createShips:(e,t,r)=>{const n=document.createElement("div");return n.id="Ships",r.forEach((r=>{const a=((e,t,r)=>{const n=document.createElement("div");return n.dataset.position=e.position,n.dataset.size=e.size,n.innerText=e.name+" "+e.size,n.draggable=!0,n.onclick=r,n.ondragstart=t,n})(r,e,t);n.appendChild(a)})),n}};const i=()=>{const e=[],t=(t,r)=>!!e.some((e=>e.column===t&&e.row===r));return{attack:(r,n)=>{if(t(r,n))throw new Error("Already shooted in that position");e.push({column:r,row:n})},hasAttacked:t}},c=()=>{let e=(()=>{let e={};return["a","b","c","d","e","f","g","h","i","j"].forEach((t=>{e[t]=new Array(10).fill({ocupied:!1,receivedAttack:!1})})),e})(),t=!1;const r=(t,r)=>e[t][r].ocupied,n=e=>({ocupied:!0,ship:e}),a=(e,t,r,n)=>{((e,t,r)=>{o(t,r+e-1)})(e,t,r);const a=(e=>{if(e<1||e>4)throw new Error("Invalid length provided");const t=e;let r=0;return{length:()=>t,isSunked:()=>t===r,hit:()=>{r++}}})(e);((e,t)=>{let r=0;for(;r<e;)t(r),r++})(e,(e=>n(e,a)))},o=(t,r)=>{if(!e.hasOwnProperty(t)||r>9)throw new Error("invalid cordinate")};return{hasShip:r,deployHorizontalShip:(t,r,o)=>{a(t,r,o,((t,a)=>{e[r][o+t]=n(a)}))},deployVerticalShip:(t,r,o)=>{const i=["a","b","c","d","e","f","g","h","i","j"];let c=i.indexOf(r);a(t,r,c,((t,r)=>{e[i[c+t]][o]=n(r)}))},receiveAttack:(r,n)=>{o(r,n),e[r][n].ocupied&&(e[r][n].ship.hit(),e[r][n].ship.isSunked()&&(()=>{let t=!0;const r=e=>!e.ocupied||e.ship.isSunked();for(const n in e)t=t&&e[n].every(r);return t})()&&(t=!0)),e[r][n].receivedAttack=!0},hasBeenAtacked:(t,r)=>(o(t,r),e[t][r].receivedAttack),wippedBoard:()=>t,iterateMap:t=>{for(const n in e)e[n].forEach(((e,a)=>{t(n,a,{shot:e.receivedAttack,ship:!!e.receivedAttack&&r(n,a)})}))},iterateShipMap:t=>{for(const r in e)e[r].forEach(((e,n)=>{t(r,n,{ship:e.ocupied,shot:e.receivedAttack})}))}}},d=(e,t)=>{t.forEach((t=>{"Horizontal"===t.direction||1===t.direction?e.deployHorizontalShip(t.size,t.column,t.row):e.deployVerticalShip(t.size,t.column,t.row)}))},l=()=>({column:"a",row:1});function s(e,t){let r=(()=>{let e=0;return{currentTurn:()=>e+1,pass:()=>{e=(e+1)%2}}})(),n={gameboard:c(),player:i()},a={gameboard:c(),player:i()};d(n.gameboard,e),d(a.gameboard,t);const o=()=>n.gameboard.wippedBoard()||a.gameboard.wippedBoard(),s=()=>1===r.currentTurn();return{hasWinner:o,isPlayerTurn:s,playTurn:(e,t)=>{if(o())throw new Error("Cant play turn if the game  is over");s()?(n.player.attack(e,t),a.gameboard.receiveAttack(e,t)):(a.player.attack(e,t),n.gameboard.receiveAttack(e,t)),r.pass()},winner:()=>o()?n.gameboard.wippedBoard()?1:0:-1,gameboards:()=>({player:n.gameboard,computer:a.gameboard}),getComputerPlay:l,iterateMap:(e,t)=>e?n.gameboard.iterateShipMap(t):a.gameboard.iterateMap(t)}}const p=[{name:"Destroyer",size:4,position:"H"},{name:"AirShip",size:3,position:"H"},{name:"Submarine",size:3,position:"H"},{name:"Ship",size:2,position:"H"},{name:"Boat",size:1,position:"H"}];function m(e){e.dataTransfer.setData("text",e.target.id)}function u(e){e.preventDefault();var t=e.dataTransfer.getData("text");e.target.appendChild(document.getElementById(t))}function h(e){e.preventDefault(),console.log(e)}!async function(){let e,t=function(e){let t=document.getElementById("player"),r=document.getElementById("enemy"),n=document.getElementById("drag-section");const a=document.getElementById("content");let i,c;const d=e=>{for(;e.firstChild;)e.removeChild(e.lastChild)},l=()=>{d(t),d(r),d(n),document.querySelectorAll(".message").forEach((e=>{e.remove()})),document.querySelectorAll(".btn").forEach((e=>{e.remove()}))};return{intialize:(a,d,s,p,m)=>{i=d,c=a,l();const u=o.createComputerGameboard(c,i),h=o.createPlayeGameboard(c),y=o.createShips(s,m,e);t.appendChild(u),r.appendChild(h),n.appendChild(y)},render:()=>{const e=(e,t,r)=>{o.fillCell(player,e,t,r)};o.fillBoard("player",e,c),o.fillBoard("enemy",e,c)},renderGameOver:(e,t)=>{l();const r=o.createMessage("Game Over: "+e+" Wins!"),n=o.createButton(t,"btn-reply");a.appendChild(r),a.appendChild(n)}}}(p);const r=()=>{e=s([{direction:1,size:2,column:"a",row:1}],[{direction:1,size:2,column:"a",row:1}]),t.intialize(e.iterateMap,a,m,u,h)},n=()=>!!e.hasWinner()&&(console.log(e.winner()),t.renderGameOver(0===e.winner()?"Player":"Computer",r),!0),a=(r,a)=>{try{e.playTurn(r,a)}catch(e){console.log(e)}if(!n()){t.render();const r=e.getComputerPlay();e.playTurn(r.column,r.row),n()||t.render()}};e=s([{direction:1,size:2,column:"a",row:1}],[{direction:1,size:2,column:"a",row:1}]),t.intialize(e.iterateMap,a,m,u,h)}()})();