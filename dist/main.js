(()=>{"use strict";const e=(e,t)=>{const r=document.createElement("td");return r.dataset.column=e,r.dataset.row=t,r.classList.add(e+"-"+t),r.innerText="#"===e?t:"-",r},t=(t,r,a)=>{const n=document.createElement("tr");for(let o=0;o<a;o++){const a=e(r[o],t);n.appendChild(a)}return n},r=(e,t,r,a)=>{const n=t+"-"+(r+1);let o;o="player"===e?document.getElementsByClassName(n)[1]:document.getElementsByClassName(n)[0],o.innerText=((e,t,r)=>"player"===t?r.ship?r.shot?"R":"S":"W":r.ship&&r.shot?"R":"W")(0,e,a)},a=(e,a)=>{const o=(t,a,n)=>{r(e,t,a,n)},c=document.createElement("div");c.classList.add("gameboard");const i=(()=>{const e=document.createElement("table"),r=["#","a","b","c","d","e","f","g","h","i","j"],a=(e=>{const t=document.createElement("tr");return e.forEach((e=>{const r=document.createElement("td");r.innerText=e,t.appendChild(r)})),t})(r);e.appendChild(a);for(let a=1;a<=10;a++){const n=t(a,r,11);e.appendChild(n)}return e})();return setTimeout((()=>n(e,o,a)),0),c.appendChild(i),c},n=(e,t,r)=>{r("player"===e,t)},o={createComputerGameboard:(e,t)=>{const r=a("enemy",e),n=(e,r,a)=>{const n=e+"-"+(r+1);document.getElementsByClassName(n)[0].addEventListener("click",(a=>{a.preventDefault(),t(e,r+1)}))};return setTimeout((()=>{((e,t)=>{console.log("here"),t(!1,e)})(n,e)})),r},createPlayeGameboard:e=>a("player",e),createMessage:e=>{const t=document.createElement("div");t.classList.add("message");const r=document.createElement("p");return r.innerText=e,t.appendChild(r),t},fillBoard:n,fillCell:r},c=()=>{const e=[],t=(t,r)=>!!e.some((e=>e.column===t&&e.row===r));return{attack:(r,a)=>{if(t(r,a))throw new Error("Already shooted in that position");e.push({column:r,row:a})},hasAttacked:t}},i=()=>{let e=(()=>{let e={};return["a","b","c","d","e","f","g","h","i","j"].forEach((t=>{e[t]=new Array(10).fill({ocupied:!1,receivedAttack:!1})})),e})(),t=!1;const r=(t,r)=>e[t][r].ocupied,a=e=>({ocupied:!0,ship:e}),n=(e,t,r,a)=>{((e,t,r)=>{o(t,r+e-1)})(e,t,r);const n=(e=>{if(e<1||e>4)throw new Error("Invalid length provided");const t=e;let r=0;return{length:()=>t,isSunked:()=>t===r,hit:()=>{r++}}})(e);((e,t)=>{let r=0;for(;r<e;)t(r),r++})(e,(e=>a(e,n)))},o=(t,r)=>{if(!e.hasOwnProperty(t)||r>9)throw new Error("invalid cordinate")};return{hasShip:r,deployHorizontalShip:(t,r,o)=>{n(t,r,o,((t,n)=>{e[r][o+t]=a(n)}))},deployVerticalShip:(t,r,o)=>{const c=["a","b","c","d","e","f","g","h","i","j"];let i=c.indexOf(r);n(t,r,i,((t,r)=>{e[c[i+t]][o]=a(r)}))},receiveAttack:(r,a)=>{o(r,a),e[r][a].ocupied&&(e[r][a].ship.hit(),e[r][a].ship.isSunked()&&(()=>{let t=!0;const r=e=>!e.ocupied||e.ship.isSunked();for(const a in e)t=t&&e[a].every(r);return t})()&&(t=!0)),e[r][a].receivedAttack=!0},hasBeenAtacked:(t,r)=>(o(t,r),e[t][r].receivedAttack),wippedBoard:()=>t,iterateMap:t=>{for(const a in e)e[a].forEach(((e,n)=>{t(a,n,{shot:e.receivedAttack,ship:!!e.receiveAttack&&r(a,n)})}))},iterateShipMap:t=>{for(const r in e)e[r].forEach(((e,a)=>{t(r,a,{ship:e.ocupied,shot:e.receivedAttack})}))}}},d=(e,t)=>{t.forEach((t=>{"Horizontal"===t.direction||1===t.direction?e.deployHorizontalShip(t.size,t.column,t.row):e.deployVerticalShip(t.size,t.column,t.row)}))},l=()=>({column:"a",row:1});!async function(){const e=()=>!!t.hasWinner()&&(r.renderGameOver(t.winner()),!0);let t=function(e,t){let r=(()=>{let e=0;return{currentTurn:()=>e+1,pass:()=>{e=(e+1)%2}}})(),a={gameboard:i(),player:c()},n={gameboard:i(),player:c()};d(a.gameboard,[]),d(n.gameboard,[]);const o=()=>a.gameboard.wippedBoard()||n.gameboard.wippedBoard(),s=()=>1===r.currentTurn();return{hasWinner:o,isPlayerTurn:s,playTurn:(e,t)=>{if(o())throw new Error("Cant play turn if the game  is over");s()?(a.player.attack(e,t),n.gameboard.receiveAttack(e,t)):(n.player.attack(e,t),a.gameboard.receiveAttack(e,t)),r.pass()},winner:()=>o()?a.gameboard.wippedBoard()?1:0:-1,gameboards:()=>({player:a.gameboard,computer:n.gameboard}),getComputerPlay:l,iterateMap:(e,t)=>e?a.gameboard.iterateShipMap(t):n.gameboard.iterateMap(t)}}(),r=function(){let e,t,r=document.getElementById("player"),a=document.getElementById("enemy");const n=e=>{for(;e.firstChild;)e.removeChild(e.lastChild)},c=()=>{n(r),n(a)};return{intialize:(n,i)=>{e=i,t=n,c();const d=o.createComputerGameboard(t,e),l=o.createPlayeGameboard(t);r.appendChild(d),a.appendChild(l)},render:()=>{const e=(e,t,r)=>{o.fillCell(player,e,t,r)};o.fillBoard("player",e,t),o.fillBoard("enemy",e,t)},renderGameOver:()=>{c();const e=o.createMessage("Game Over");document.getElementById("content").appendChild(e)}}}();r.intialize(t.iterateMap,((a,n)=>{try{console.log(a+"-"+n),t.playTurn(a,n)}catch(e){console.log(e)}e()||(r.render(),t.getComputerPlay(),e()||r.render())}))}()})();